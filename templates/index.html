<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BossHub Ultimate Guardian</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; }
        .card { background-color: #1e1e1e; border: 1px solid #333; margin-bottom: 20px; }
        .nav-tabs .nav-link { color: #aaa; border: 1px solid transparent; }
        .nav-tabs .nav-link.active { background-color: #1e1e1e; color: #0d6efd; border-color: #333 #333 #1e1e1e; }
        .table-dark { --bs-table-bg: #1e1e1e; }
        pre { background: #000; color: #0f0; padding: 10px; border-radius: 5px; border: 1px solid #333; max-height: 200px; overflow-y: auto;}
        .stat-val { font-size: 1.5rem; font-weight: bold; }
        .text-neon { color: #00ff41; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-black border-bottom border-secondary mb-3">
    <div class="container">
        <span class="navbar-brand text-neon"><i class="bi bi-shield-lock"></i> BossHub Ultimate Guardian</span>
        <span class="text-white small">Root:BossHubRoot | Port 8989</span>
    </div>
</nav>

<div class="container">
    
    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard"><i class="bi bi-speedometer2"></i> Monitor & Stats</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#threats"><i class="bi bi-radioactive"></i> Threat Hunter</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tools"><i class="bi bi-tools"></i> Admin Tools</button></li>
    </ul>

    <div class="tab-content" id="myTabContent">
        
        <div class="tab-pane fade show active" id="dashboard">
            <div class="row text-center mb-3">
                <div class="col-md-3"><div class="card p-3"><span class="text-muted">CPU</span><div class="stat-val" id="cpuVal">-</div></div></div>
                <div class="col-md-3"><div class="card p-3"><span class="text-muted">RAM</span><div class="stat-val" id="ramVal">-</div></div></div>
                <div class="col-md-3"><div class="card p-3"><span class="text-muted">Uptime</span><div id="uptimeVal">-</div></div></div>
                <div class="col-md-3"><div class="card p-3"><span class="text-muted">OS</span><div id="osVal">-</div></div></div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-primary text-white">Disk & Network</div>
                        <div class="card-body" id="diskNetBody">Loading...</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-danger text-white">Security Overview (Firewall & Login)</div>
                        <div class="card-body">
                            <h6><i class="bi bi-bricks"></i> Firewall (UFW)</h6>
                            <pre id="firewallOut" class="mb-2">-</pre>
                            <h6><i class="bi bi-person-lines-fill"></i> Last 5 Logins</h6>
                            <ul class="list-group list-group-flush small" id="logList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="threats">
            <div class="card border-warning">
                <div class="card-header text-warning"><i class="bi bi-wifi-off"></i> 1. Network & Mining Connections</div>
                <div class="card-body">
                    <button class="btn btn-warning btn-sm mb-2" onclick="scanNetwork()"><i class="bi bi-radar"></i> Scan Active Connections</button>
                    <div class="table-responsive">
                        <table class="table table-dark table-sm table-striped">
                            <thead><tr><th>PID</th><th>Local</th><th>Remote (Pool?)</th><th>Risk Score</th><th>Reason</th></tr></thead>
                            <tbody id="netThreatBody"><tr><td colspan="5" class="text-center text-muted">Ready to scan</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card border-danger mt-3">
                <div class="card-header text-danger"><i class="bi bi-bug"></i> 2. Hestia/Vesta Script Scanner</div>
                <div class="card-body">
                    <div class="input-group mb-2">
                        <span class="input-group-text bg-dark text-light">Path</span>
                        <input type="text" class="form-control bg-dark text-light" id="malwarePath" value="/home">
                        <button class="btn btn-danger" onclick="scanMalware()">Deep Scan</button>
                    </div>
                    <div id="malwareResult"></div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="tools">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header"><i class="bi bi-globe"></i> Nmap Port Scanner</div>
                        <div class="card-body">
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" id="nmapTarget" placeholder="IP/Domain">
                                <button class="btn btn-primary" onclick="runNmap()">Scan</button>
                            </div>
                            <pre id="nmapOut"></pre>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header"><i class="bi bi-hdd-rack"></i> Service Manager</div>
                        <div class="card-body">
                            <input type="text" class="form-control mb-2" id="srvName" placeholder="Service Name (e.g., nginx)">
                            <div class="btn-group w-100 mb-2">
                                <button class="btn btn-outline-light" onclick="srvAction('status')">Status</button>
                                <button class="btn btn-outline-success" onclick="srvAction('start')">Start</button>
                                <button class="btn btn-outline-warning" onclick="srvAction('restart')">Restart</button>
                                <button class="btn btn-outline-danger" onclick="srvAction('stop')">Stop</button>
                            </div>
                            <pre id="srvOut"></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><i class="bi bi-file-earmark-diff"></i> Recent Modified Files</div>
                <div class="card-body">
                    <button class="btn btn-info btn-sm" onclick="scanFiles()">Find files modified in last 24h</button>
                    <pre id="filesOut" class="mt-2"></pre>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API = `http://${location.hostname}:8989/api`;
    const AUTH = { headers: { 'Authorization': 'Basic ' + btoa('root:BossHubRoot'), 'Content-Type': 'application/json' } };

    async function get(endpoint) { const r = await fetch(API+endpoint, AUTH); return r.json(); }
    async function post(endpoint, data) { 
        const r = await fetch(API+endpoint, { ...AUTH, method: 'POST', body: JSON.stringify(data)}); 
        return r.json(); 
    }

    // --- Tab 1: Dashboard ---
    async function refreshDashboard() {
        const sys = await get('/stats');
        document.getElementById('cpuVal').innerText = sys.cpu.percent + '%';
        document.getElementById('ramVal').innerText = sys.ram.percent + '%';
        document.getElementById('uptimeVal').innerText = sys.uptime;
        document.getElementById('osVal').innerText = sys.os;
        
        let dHtml = '<h6>Partitions:</h6>';
        sys.disk.forEach(d => dHtml += `<div class="d-flex justify-content-between small"><span>${d.mount}</span><span>${d.percent}%</span></div>`);
        dHtml += '<hr><h6>IP Addresses:</h6>';
        for(let k in sys.network) dHtml += `<small class="d-block text-info">${k}: ${sys.network[k]}</small>`;
        document.getElementById('diskNetBody').innerHTML = dHtml;

        const sec = await get('/security_basic');
        document.getElementById('firewallOut').innerText = sec.firewall;
        document.getElementById('logList').innerHTML = sec.logs.map(l => `<li class="list-group-item bg-dark text-light border-secondary py-1">${l}</li>`).join('');
    }

    // --- Tab 2: Threat Hunter ---
    async function scanNetwork() {
        const t = document.getElementById('netThreatBody');
        t.innerHTML = '<tr><td colspan="5">Scanning...</td></tr>';
        const res = await get('/threats/network');
        t.innerHTML = '';
        if(res.error) return t.innerHTML = `<tr><td colspan="5" class="text-danger">${res.error}</td></tr>`;
        if(res.length === 0) return t.innerHTML = `<tr><td colspan="5" class="text-success">No active threats found.</td></tr>`;
        res.forEach(r => {
            t.innerHTML += `<tr class="table-danger"><td>${r.pid}</td><td>${r.laddr}</td><td>${r.raddr}</td><td>${r.risk}</td><td>${r.reasons}</td></tr>`;
        });
    }

    async function scanMalware() {
        const div = document.getElementById('malwareResult');
        div.innerHTML = '<div class="spinner-border text-danger spinner-border-sm"></div> Scanning files...';
        const res = await get('/threats/malware?path=' + document.getElementById('malwarePath').value);
        if(res.error) return div.innerText = res.error;
        let h = `<p class="mt-2 mb-1">Scanned: ${res.scanned}, Infected: <span class="badge bg-danger">${res.infected.length}</span></p>`;
        res.infected.forEach(f => h += `<div class="alert alert-dark border-danger small py-1 mb-1 text-danger"><strong>${f.path}</strong><br>${f.threats.join(', ')}</div>`);
        div.innerHTML = h;
    }

    // --- Tab 3: Tools ---
    async function runNmap() {
        const tgt = document.getElementById('nmapTarget').value;
        const out = document.getElementById('nmapOut');
        out.innerText = 'Scanning...';
        const res = await post('/tools/nmap', {target: tgt});
        let txt = `Status: ${res.status}\n`;
        res.ports.forEach(p => txt += `Port ${p.port}: ${p.state} (${p.service})\n`);
        out.innerText = txt;
    }

    async function srvAction(act) {
        const srv = document.getElementById('srvName').value;
        if(!srv) return alert('Enter service name');
        const out = document.getElementById('srvOut');
        out.innerText = 'Executing...';
        const res = await post('/tools/service', {service: srv, action: act});
        out.innerText = res.output || res.error || 'Done';
    }

    async function scanFiles() {
        const out = document.getElementById('filesOut');
        out.innerText = 'Finding...';
        const res = await post('/tools/files', {days: 1});
        out.innerText = res.files.join('\n') || 'No files found';
    }

    // Init
    refreshDashboard();
    setInterval(refreshDashboard, 30000); // Auto refresh dashboard every 30s
</script>
</body>
</html>
